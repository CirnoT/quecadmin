<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QuecAdmin :: Home</title>
    <!-- Import all the bootstrap css files from css folder -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />

    <!-- Logo -->
    <link rel="simpleadmin-logo" href="favicon.ico" />

    <!--  Import BootStrap Javascript -->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/alpinejs.min.js" defer></script>
  </head>
  <body>
    <main>
      <div class="container my-4" x-data="processAllInfos()">
        <nav class="navbar navbar-expand-lg mt-2">
          <div class="container-fluid">
            <a class="navbar-brand" href="/"
              ><span class="mb-0 h4">QuecAdmin</span></a
            >
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarText"
              aria-controls="navbarText"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="/"
                    >Home</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="network.html">Network</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/scanner.html">Scan</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/settings.html">Settings</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/sms.html">SMS</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/deviceinfo.html"
                    >Device Information</a
                  >
                </li>
              </ul>
              <span class="navbar-text">
                <button class="btn btn-link text-reset" id="darkModeToggle">
                  Dark Mode
                </button>
              </span>
            </div>
          </div>
        </nav>

        <div class="row align-items-center mt-5 gap-md-3 gap-2">
          <div class="col align-self-center">
            <div class="card">
              <div
                class="card-body d-flex flex-column align-items-center justify-content-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 320 512"
                  height="85"
                  width="85"
                >
                  <path
                    fill="#fdb53c"
                    d="M160 64c-26.5 0-48 21.5-48 48V276.5c0 17.3-7.1 31.9-15.3 42.5C86.2 332.6 80 349.5 80 368c0 44.2 35.8 80 80 80s80-35.8 80-80c0-18.5-6.2-35.4-16.7-48.9c-8.2-10.6-15.3-25.2-15.3-42.5V112c0-26.5-21.5-48-48-48zM48 112C48 50.2 98.1 0 160 0s112 50.1 112 112V276.5c0 .1 .1 .3 .2 .6c.2 .6 .8 1.6 1.7 2.8c18.9 24.4 30.1 55 30.1 88.1c0 79.5-64.5 144-144 144S16 447.5 16 368c0-33.2 11.2-63.8 30.1-88.1c.9-1.2 1.5-2.2 1.7-2.8c.1-.3 .2-.5 .2-.6V112zM208 368c0 26.5-21.5 48-48 48s-48-21.5-48-48c0-20.9 13.4-38.7 32-45.3V272c0-8.8 7.2-16 16-16s16 7.2 16 16v50.7c18.6 6.6 32 24.4 32 45.3z"
                  />
                </svg>
                <h1
                  class="card-text mt-4"
                  x-text="temperature + ' &deg;C'"
                ></h1>
              </div>
              <div class="card-footer text-center">Temperature</div>
            </div>
          </div>

          <div class="col align-self-center">
            <div class="card">
              <div
                class="card-body d-flex flex-column align-items-center justify-content-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 384 512"
                  height="85"
                  width="85"
                >
                  <path
                    fill="#6a46d8"
                    d="M64 0H242.7c17 0 33.3 6.7 45.3 18.7L365.3 96c12 12 18.7 28.3 18.7 45.3V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64C0 28.7 28.7 0 64 0zM96 192c-17.7 0-32 14.3-32 32v32h64V192H96zM64 352h80 96 80V288H240 144 64v64zM320 224c0-17.7-14.3-32-32-32H256v64h64V224zM160 192v64h64V192H160zM288 448c17.7 0 32-14.3 32-32V384H256v64h32zM160 384v64h64V384H160zM64 416c0 17.7 14.3 32 32 32h32V384H64v32z"
                  />
                </svg>
                <h1 class="card-text mt-4" x-text="simStatus"></h1>
              </div>
              <div class="card-footer text-center">SIM Status</div>
            </div>
          </div>

          <div class="col align-self-center">
            <div class="card">
              <div
                class="card-body d-flex flex-column align-items-center justify-content-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 640 512"
                  height="85"
                  width="85"
                >
                  <path
                    fill="#2fa7fb"
                    d="M576 0c17.7 0 32 14.3 32 32V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V32c0-17.7 14.3-32 32-32zM448 96c17.7 0 32 14.3 32 32V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V128c0-17.7 14.3-32 32-32zM352 224V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V224c0-17.7 14.3-32 32-32s32 14.3 32 32zM192 288c17.7 0 32 14.3 32 32V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V320c0-17.7 14.3-32 32-32zM96 416v64c0 17.7-14.3 32-32 32s-32-14.3-32-32V416c0-17.7 14.3-32 32-32s32 14.3 32 32z"
                  />
                </svg>
                <h1 class="card-text mt-4" x-text="signalPercentage + '%'"></h1>
              </div>
              <div class="card-footer text-center">Signal Percentage</div>
            </div>
          </div>

          <div class="col align-self-center">
            <div class="card">
              <div
                class="card-body d-flex flex-column align-items-center justify-content-center"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 640 512"
                  height="85"
                  width="85"
                >
                  <path
                    fill="#20c0ae"
                    d="M0 336c0 79.5 64.5 144 144 144H512c70.7 0 128-57.3 128-128c0-61.9-44-113.6-102.4-125.4c4.1-10.7 6.4-22.4 6.4-34.6c0-53-43-96-96-96c-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32C167.6 32 96 103.6 96 192c0 2.7 .1 5.4 .2 8.1C40.2 219.8 0 273.2 0 336z"
                  />
                </svg>
                <h1
                  class="card-text mt-4"
                  x-text="internetConnectionStatus"
                ></h1>
              </div>
              <div class="card-footer text-center">Internet Connection</div>
            </div>
          </div>
        </div>

        <div class="row mt-5 gap-3">
          <div class="col">
            <div class="card">
              <div class="card-header">Network Information</div>
              <div class="card-body">
                <div class="card-text table-responsive-sm">
                  <table class="table">
                    <tbody>
                      <tr>
                        <th scope="row">Provider</th>
                        <td x-text="networkProvider"></td>
                      </tr>
                      <tr x-show="cellID != '-'">
                        <th scope="row">Current Cell ID</th>
                        <td x-text="cellID"></td>
                      </tr>
                      <tr x-show="eNBID != '-'">
                        <th scope="row">eNB ID</th>
                        <td x-text="eNBID"></td>
                      </tr>
                      <tr x-show="sectorID != '-'">
                        <th scope="row">Sector ID</th>
                        <td x-text="sectorID"></td>
                      </tr>
                      <tr x-show="tac != '-'">
                        <th scope="row">TAC</th>
                        <td x-text="tac"></td>
                      </tr>
                      <tr>
                        <th scope="row">Data Class</th>
                        <td x-text="networkMode"></td>
                      </tr>
                      <tr x-show="bands.length > 0">
                        <th scope="row">Bands</th>
                        <td>
                          <ul class="list-unstyled mb-0">
                            <template x-for="(band, idx) in bands">
                              <li 
                                x-text="band + (bandwidth[idx] ? ('@' + bandwidth[idx] + 'Mhz') : '') + ' earfcn: ' + (earfcns[idx] ?? 'n/a') + ' phy-cellid: ' + (pcis[idx] ?? 'n/a')"
                              ></li>
                            </template>
                          </ul>
                        </td>
                      </tr>
                      <tr x-show="ipv4 != '0.0.0.0'">
                        <th scope="row">IPv<sup>4</sup></th>
                        <td x-text="ipv4"></td>
                      </tr>
                      <tr x-show="ipv6 != '0:0:0:0:0:0:0:0'">
                        <th scope="row">IPv<sup>6</sup></th>
                        <td x-text="ipv6"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="card-footer">
                <div class="row row-cols-2">
                  <div class="col">
                    <p class="btn">Refresh Rate (min 3s)</p>
                  </div>
                  <div class="col">
                    <div class="input-group">
                      <input
                        x-model="newRefreshRate"
                        class="form-control"
                        type="number"
                        min="3"
                        max="60"
                        x-bind:placeholder="refreshRate + 's'"
                      />
                      <button
                        @click="updateRefreshRate()"
                        class="btn btn-outline-secondary"
                        type="button"
                      >
                        Set
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col">
            <div class="card">
              <div class="card-header">Signal Information</div>
              <div class="card-body">
                <div class="card-text table-responsive-sm">
                  <table class="table">
                    <tbody>
                      <tr>
                        <th scope="row">Assessment</th>
                        <td x-text="signalAssessment"></td>
                      </tr>
                      <tr>
                        <th scope="row">Traffic Stats</th>
                        <td
                          x-text="downloadStat + ' DL / ' + uploadStat + ' UL'"
                        ></td>
                      </tr>
                      <tr x-show="rssi != '-'">
                        <th scope="row">RSSI<sup>4G</sup></th>
                        <td x-text="rssi"></td>
                      </tr>
                      <tr x-show="rsrpLTE != '-'">
                        <th scope="row">RSRP<sup>4G</sup></th>
                        <td
                          class="gap-4 align-items-center"
                          x-data="{
                          getProgressBarClass: function() {
                              // Remove the percentage sign and convert to integer
                              var percentage = parseInt(this.rsrpLTEPercentage);
                              
                              if (percentage >= 60) {
                                  return 'progress-bar bg-success is-medium';
                              } else if (percentage >= 40) {
                                  return 'progress-bar bg-warning is-warning is-medium';
                              } else {
                                  return 'progress-bar bg-danger is-medium';
                              }
                          }
                        }"
                        >
                          <div
                            x-show="rsrpLTE != '-' && rsrpLTEPercentage != '0'"
                            class="progress w-100"
                            role="progressbar"
                            aria-label="RSRP BAR"
                            :aria-valuenow="rsrpLTEPercentage"
                            aria-valuemin="0"
                            aria-valuemax="100"
                            style="height: 18px"
                          >
                            <div
                              :class="getProgressBarClass()"
                              :style="'width: ' + rsrpLTEPercentage + '%'"
                            >
                              <span
                                x-text="rsrpLTE + ' / ' + rsrpLTEPercentage + '%'"
                              ></span>
                            </div>
                          </div>
                          <span
                            x-show="rsrpLTEPercentage == '0'"
                            x-text="rsrpLTE"
                          ></span>
                          <span x-show="rsrpLTE == '-'" class="fst-italic">
                            None
                          </span>
                        </td>
                      </tr>
                      <tr x-show="sinrLTE != '-'">
                        <th scope="row">SINR<sup>4G</sup></th>
                        <td
                          class="gap-4 align-items-center"
                          x-data="{
                          getProgressBarClass: function() {
                              // Remove the percentage sign and convert to integer
                              var percentage = parseInt(this.sinrLTEPercentage);
                              
                              if (percentage >= 60) {
                                  return 'progress-bar bg-success is-medium';
                              } else if (percentage >= 40) {
                                  return 'progress-bar bg-warning is-warning is-medium';
                              } else {
                                  return 'progress-bar bg-danger is-medium';
                              }
                          }
                        }"
                        >
                          <div
                            x-show="sinrLTE != '-' && sinrLTEPercentage != '0'"
                            class="progress w-100"
                            role="progressbar"
                            aria-label="SINR BAR"
                            :aria-valuenow="sinrLTEPercentage"
                            aria-valuemin="0"
                            aria-valuemax="100"
                            style="height: 18px"
                          >
                            <div
                              :class="getProgressBarClass()"
                              :style="'width: ' + sinrLTEPercentage +'%'"
                            >
                              <span
                                x-text="sinrLTE + ' / ' + sinrLTEPercentage +'%'"
                              ></span>
                            </div>
                          </div>
                          <span
                            x-text="sinrLTE"
                            x-show="sinrLTEPercentage == '0'"
                          ></span>
                          <span x-show="sinrLTE == '-'" class="fst-italic">
                            None
                          </span>
                        </td>
                      </tr>
                      <tr x-show="rsrqLTE != '-'">
                        <th scope="row">RSRQ<sup>4G</sup></th>
                        <td
                          class="gap-4 align-items-center"
                          x-data="{ getProgressBarClass: function() {
                          // Remove the percentage sign and convert to integer
                          var percentage = parseInt(this.rsrqLTEPercentage);
                          
                          if (percentage >= 60) {
                              return 'progress-bar bg-success is-medium';
                          } else if (percentage >= 40) {
                              return 'progress-bar bg-warning is-warning is-medium';
                          } else {
                              return 'progress-bar bg-danger is-medium';
                          }
                      } }"
                        >
                          <div
                            x-show="rsrqLTE != '-' && rsrqLTEPercentage != '0'"
                            class="progress w-100"
                            role="progressbar"
                            aria-label="RSRQ BAR"
                            :aria-valuenow="rsrqLTEPercentage"
                            aria-valuemin="0"
                            aria-valuemax="100"
                            style="height: 18px"
                          >
                            <div
                              :class="getProgressBarClass()"
                              :style="'width: ' + rsrqLTEPercentage + '%'"
                            >
                              <span
                                x-text="rsrqLTE + ' / ' +  rsrqLTEPercentage + '%'"
                              ></span>
                            </div>
                          </div>
                          <span
                            x-show="rsrqLTEPercentage == '0'"
                            x-text="rsrqLTE"
                          ></span>
                          <span x-show="rsrqLTE == '-'" class="fst-italic">
                            None
                          </span>
                        </td>
                      </tr>
                      <tr x-show="cqiLTE != '-'">
                        <th scope="row">CQI<sup>4G</sup></th>
                        <td x-text="cqiLTE"></td>
                      </tr>
                      <tr x-show="riLTE != '-'">
                        <th scope="row">RI<sup>4G</sup></th>
                        <td x-text="riLTE"></td>
                      </tr>
                      <tr x-show="mcsLTE != '-'">
                        <th scope="row">MCS<sup>4G</sup></th>
                        <td x-text="mcsLTE"></td>
                      </tr>
                      <tr x-show="rsrpNR != '-'">
                        <th scope="row">NR RSRP<sup>5G</sup></th>
                        <td
                          class="gap-4 align-items-center"
                          x-data="{
                          getProgressBarClass: function() {
                              // Remove the percentage sign and convert to integer
                              var percentage = parseInt(this.rsrpNRPercentage);
                              
                              if (percentage >= 60) {
                                  return 'progress-bar bg-success is-medium';
                              } else if (percentage >= 40) {
                                  return 'progress-bar bg-warning is-warning is-medium';
                              } else {
                                  return 'progress-bar bg-danger is-medium';
                              }
                          }
                        }"
                        >
                          <div
                            x-show="rsrpNR != '-' && rsrpNRPercentage != '0'"
                            class="progress w-100"
                            role="progressbar"
                            aria-label="RSRP BAR"
                            :aria-valuenow="rsrpNRPercentage"
                            aria-valuemin="0"
                            aria-valuemax="100"
                            style="height: 18px"
                          >
                            <div
                              :class="getProgressBarClass()"
                              :style="'width: ' + rsrpNRPercentage + '%'"
                            >
                              <span
                                x-text="rsrpNR + ' / ' + rsrpNRPercentage + '%'"
                              ></span>
                            </div>
                          </div>
                          <span
                            x-show="rsrpNRPercentage == '0'"
                            x-text="rsrpNR"
                          ></span>
                          <span x-show="rsrpNR == '-'" class="fst-italic">
                            None
                          </span>
                        </td>
                      </tr>
                      <tr x-show="sinrNR != '-'">
                        <th scope="row">NR SINR<sup>5G</sup></th>
                        <td
                          class="gap-4 align-items-center"
                          x-data="{
                          getProgressBarClass: function() {
                              // Remove the percentage sign and convert to integer
                              var percentage = parseInt(this.sinrNRPercentage);
                              
                              if (percentage >= 60) {
                                  return 'progress-bar bg-success is-medium';
                              } else if (percentage >= 40) {
                                  return 'progress-bar bg-warning is-warning is-medium';
                              } else {
                                  return 'progress-bar bg-danger is-medium';
                              }
                          }
                        }"
                        >
                          <div
                            x-show="sinrNR != '-' && sinrNRPercentage != '0'"
                            class="progress w-100"
                            role="progressbar"
                            aria-label="SINR BAR"
                            :aria-valuenow="sinrNRPercentage"
                            aria-valuemin="0"
                            aria-valuemax="100"
                            style="height: 18px"
                          >
                            <div
                              :class="getProgressBarClass()"
                              :style="'width: ' + sinrNRPercentage +'%'"
                            >
                              <span
                                x-text="sinrNR + ' / ' + sinrNRPercentage +'%'"
                              ></span>
                            </div>
                          </div>
                          <span
                            x-text="sinrNR"
                            x-show="sinrNRPercentage == '0'"
                          ></span>
                          <span x-show="sinrNR == '-'" class="fst-italic">
                            None
                          </span>
                        </td>
                      </tr>
                      <tr x-show="rsrqNR != '-'">
                        <th scope="row">NR RSRQ<sup>5G</sup></th>
                        <td
                          x-data="{ getProgressBarClass: function() {
                          // Remove the percentage sign and convert to integer
                          var percentage = parseInt(this.rsrqNRPercentage);
                          
                          if (percentage >= 60) {
                              return 'progress-bar bg-success is-medium';
                          } else if (percentage >= 40) {
                              return 'progress-bar bg-warning is-warning is-medium';
                          } else {
                              return 'progress-bar bg-danger is-medium';
                          }
                      } }"
                        >
                          <div
                            x-show="rsrqNR != '-' && rsrqNRPercentage != '0'"
                            class="progress w-100"
                            role="progressbar"
                            aria-label="RSRQ BAR"
                            :aria-valuenow="rsrqNRPercentage"
                            aria-valuemin="0"
                            aria-valuemax="100"
                            style="height: 18px"
                          >
                            <div
                              :class="getProgressBarClass()"
                              :style="'width: ' + rsrqNRPercentage + '%'"
                            >
                              <span
                                x-text="rsrqNR + ' / ' + rsrqNRPercentage + '%'"
                              ></span>
                            </div>
                          </div>
                          <span
                            x-show="rsrqNRPercentage == '0'"
                            x-text="rsrqNR"
                          ></span>
                          <span x-show="rsrqNR == '-'" class="fst-italic">
                            None
                          </span>
                        </td>
                      </tr>
                      <tr x-show="cqiNR != '-'">
                        <th scope="row">CQI<sup>5G</sup></th>
                        <td x-text="cqiNR"></td>
                      </tr>
                      <tr x-show="riNR != '-'">
                        <th scope="row">RI<sup>5G</sup></th>
                        <td x-text="riNR"></td>
                      </tr>
                      <tr x-show="mcsNR != '-'">
                        <th scope="row">MCS<sup>5G</sup></th>
                        <td x-text="mcsNR"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="card-footer">
                <div class="card-text">
                  <div class="row">
                    <div class="col">
                      <div>
                        <p>Date Updated</p>
                      </div>
                    </div>

                    <div class="col">
                      <p x-text="lastUpdate"></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script src="js/dark-mode.js"></script>

    <script>
      function processAllInfos() {
        return {
          internetConnectionStatus: "Disconnected",
          temperature: "N/A",
          simStatus: "No SIM",
          activeSim: "N/A",
          networkProvider: "N/A",
          networkMode: "Disconnected",
          bands: [],
          bandwidth: [],
          earfcns: [],
          pcis: [],
          ipv4: "0.0.0.0",
          ipv6: "0:0:0:0:0:0:0:0",
          cellID: "-",
          sectorID: "-",
          eNBID: "-",
          tac: "-",
          rssi: "-",
          cqiLTE: "-",
          cqiNR: "-",
          riLTE: "-",
          riNR: "-",
          mcsLTE: "-",
          mcsNR: "-",
          rsrpLTE: "-",
          rsrpNR: "-",
          rsrpLTEPercentage: "0%",
          rsrpNRPercentage: "0%",
          rsrqLTE: "-",
          rsrqNR: "-",
          rsrqLTEPercentage: "0%",
          rsrqNRPercentage: "0%",
          sinrLTE: "-",
          sinrNR: "-",
          sinrLTEPercentage: "0%",
          sinrNRPercentage: "0%",
          signalPercentage: "0",
          signalAssessment: "N/A",
          lastUpdate: new Date().toLocaleString(),
          newRefreshRate: null,
          refreshRate: 3,
          downloadStat: "0",
          uploadStat: "0",

          fetchAllInfo() {
            fetch(
              "/cgi-bin/get_atcommand?" +
                new URLSearchParams({
                  cmd: 'AT+QTEMP;+QUIMSLOT?;+QSIMSTAT?;+QSPN;+QENG="servingcell";+QCAINFO;+QNWCFG="lte_csi";+QNWCFG="nr5g_csi";+QMAP="WWANIP";+QGDNRCNT?'
                })
            ).then((response) => {
              response.text().then((data) => {
                // content here
                if (data.includes("ERROR")) {
                  console.log(`Error fetching data: ${data}`);
                  return;
                } else {
                  const rawdata = data.replace("\r", "").trim();
                  const lines = rawdata.split("\r\n");

                  console.log(lines);

                  // --- Temperature ---
                  // find this example value from lines "+QTEMP:"cpuss-0-usr","50"
                  try {
                    this.temperature = lines
                      .find((line) => line.includes('+QTEMP:"cpuss-0-usr"'))
                      .split(",")[1]
                      .replace(/"/g, "");
                  } catch (error) {
                    this.temperature = lines
                      .find((line) => line.includes('+QTEMP:"cpu0-a7-usr"'))
                      .split(",")[1]
                      .replace(/"/g, "");
                  }

                  // --- Active SIM ---
                  // find this example value from lines "+QUIMSLOT: 1"
                  const current_sim = lines
                    .find((line) => line.includes("+QUIMSLOT:"))
                    .split(" ")[1]
                    .replace(/"/g, "");

                  // --- SIM Status ---
                  // find this example value from lines "+QSIMSTAT: 0,1"
                  // only get the last digit of 0,1
                  const sim_status = lines
                    .find((line) => line.includes("+QSIMSTAT:"))
                    .split(" ")[1]
                    .replace(/"/g, "")
                    .split(",")[1];

                  if (sim_status == 1) {
                    this.simStatus = `SIM${current_sim}`
                  } else if (sim_status == 0) {
                    this.simStatus = "No SIM";
                  }

                  // --- Network Provider ---
                  // find this example value from lines "+QSPN: \"515 66\",\"515 66\",\"DITO\",0,\"51566\""
                  // remove any spaces
                  const network_provider = lines
                    .find((line) => line.includes("+QSPN:"))
                    .split(",")[0]
                    .replace("+QSPN: ", "")
                    .replace(/"/g, "")
                    .replace(/ /g, "");

                  // if network provider is composed of numbers and spaces, and no letters then use .split(",")[2]
                  if (network_provider.match(/^[0-9]+$/) != null) {
                    this.networkProvider = lines
                      .find((line) => line.includes("+QSPN:"))
                      .split(",")[2]
                      .replace(/"/g, "");
                  } else {
                    this.networkProvider = network_provider;
                  }

                  // --- Network Mode ---
                  // find this example value from lines "+QENG: \"servingcell\",\"NOCONN\",\"NR5G-SA\",\"TDD\",515,66,7000C4001,475,702000,620640,78,12,-83,-3,16,1,-\r"
                  try {
                    const network_mode = lines
                      .find((line) => line.includes('+QENG: "servingcell"'))
                      .split(",")[2]
                      .replace(/"/g, "");

                    const duplex_mode = lines
                      .find((line) => line.includes('+QENG: "servingcell"'))
                      .split(",")[3]
                      .replace(/"/g, "");

                    if (network_mode == "NR5G-SA") {
                      if (duplex_mode == "TDD") {
                        this.networkMode = "5G SA TDD";
                      } else if (duplex_mode == "FDD") {
                        this.networkMode = "5G SA FDD";
                      }
                    }

                    if (network_mode == "LTE") {
                      // get the FDD | TDD value
                      const is_tdd = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[3]
                        .replace(/"/g, "");

                      if (is_tdd == "TDD") {
                        this.networkMode = "4G LTE TDD";
                      } else if (is_tdd == "FDD") {
                        this.networkMode = "4G LTE FDD";
                      }
                    }
                  } catch (error) {
                    // find this example value from lines "+QENG: \"LTE\",\"FDD\",515,03,22AE76D,398,1350,3,4,4,BF82,-110,-13,-78,10,6,200,-\r"
                    const network_mode_lte = lines
                      .find((line) => line.includes('+QENG: "LTE"'))
                      .split(",")[0]
                      .replace("+QENG: ", "")
                      .replace(/"/g, "");

                    try {
                      // find this example value from lines "+QENG: \"NR5G-NSA\",515,03,843,-95,20,-11,528030,41,8,1\r"
                      const network_mode_5g = lines
                        .find((line) => line.includes('+QENG: "NR5G-NSA"'))
                        .split(",")[0]
                        .replace("+QENG: ", "")
                        .replace(/"/g, "");

                      this.networkMode = "5G NSA";
                    } catch (error) {
                      if (network_mode_lte == "FDD") {
                        this.networkMode = "4G LTE FDD";
                      } else if (network_mode_lte == "TDD") {
                        this.networkMode = "4G LTE TDD";
                      }
                    }
                  }

                  // --- Bands ---
                  // Get all the values with LTE BAND n (for example, LTE BAND 3, LTE BAND 1) and then store them in an array
                  const lte_bands = lines.filter((line) =>
                    line.includes("LTE BAND")
                  );

                  // since it includes the whole line, we need to extract the band part only
                  for (let i = 0; i < lte_bands.length; i++) {
                    lte_bands[i] = lte_bands[i].split(",")[3].replace(/"/g, "").replace("LTE BAND ", "B");;
                  }

                  // Get all the values with NR BAND n (for example, NR BAND 3, NR BAND 1) and then store them in an array
                  const bands_5g = lines.filter((line) =>
                    line.includes("NR5G BAND")
                  );

                  // since it includes the whole line, we need to extract the band number only
                  for (let i = 0; i < bands_5g.length; i++) {
                    bands_5g[i] = bands_5g[i].split(",")[3].replace(/"/g, "").replace("NR5G BAND ", "n");
                  }

                  this.bands = [...lte_bands, ...bands_5g]

                  // --- Bandwidth ---
                  if (
                    this.networkMode == "5G SA TDD" ||
                    this.networkMode == "5G SA FDD"
                  ) {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const nr_pcc_bandwidth = 
                      this.calculateNrBandwidth(
                        lines
                          .find((line) => line.includes('+QCAINFO: "PCC"'))
                          .split(",")[2]
                      );

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const nr_scc_bandwidth = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // If empty, then proceed to error block
                      if (nr_scc_bandwidth.length == 0) {
                        throw "No SCC Bandwidth";
                      }

                      // process all the values in the array and extract the bandwidth part only
                      for (let i = 0; i < nr_scc_bandwidth.length; i++) {
                        nr_scc_bandwidth[i] = this.calculateNrBandwidth(nr_scc_bandwidth[i].split(",")[2]);
                      }

                      // combine the PCC and SCC bandwidth values
                      this.bandwidth = [nr_pcc_bandwidth, ...nr_scc_bandwidth]
                    } catch (error) {
                      this.bandwidth = [nr_pcc_bandwidth]
                    }
                  } else if (
                    this.networkMode == "4G LTE FDD" ||
                    this.networkMode == "4G LTE TDD" ||
                    this.networkMode == "5G NSA"
                  ) {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const lte_pcc_bandwidth = 
                      this.calculateLteBandwidth(
                        lines
                          .find((line) => line.includes('+QCAINFO: "PCC"'))
                          .split(",")[2]
                      );

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const lte_scc_bandwidth = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // If empty, then proceed to error block
                      if (lte_scc_bandwidth.length == 0) {
                        throw "No SCC Bandwidth";
                      }

                      // process all the values in the array and extract the bandwidth part only
                      for (let i = 0; i < lte_scc_bandwidth.length; i++) {
                        if (lte_scc_bandwidth[i].includes('LTE BAND')) {
                          lte_scc_bandwidth[i] = this.calculateLteBandwidth(lte_scc_bandwidth[i].split(",")[2]);
                        } else if (lte_scc_bandwidth[i].includes('NR5G BAND')) {
                          lte_scc_bandwidth[i] = this.calculateNrBandwidth(lte_scc_bandwidth[i].split(",")[2]);
                        }
                      }

                      // combine the PCC and SCC bandwidth values
                      this.bandwidth = [lte_pcc_bandwidth, ...lte_scc_bandwidth]
                    } catch (error) {
                      this.bandwidth = [lte_pcc_bandwidth]
                    }
                  } else {
                    this.bandwidth = [];
                  }

                  // --- E/ARFCN ---
                  if (
                    this.networkMode == "5G SA TDD" ||
                    this.networkMode == "5G SA FDD"
                  ) {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const nr_pcc_arfcn = lines
                      .find((line) => line.includes('+QCAINFO: "PCC"'))
                      .split(",")[1];

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const nr_scc_arfcn = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // if empty, then proceed to error block
                      if (nr_scc_arfcn.length == 0) {
                        throw "No SCC ARFCN";
                      }

                      // process all the values in the array and extract the ARFCN part only
                      for (let i = 0; i < nr_scc_arfcn.length; i++) {
                        nr_scc_arfcn[i] = nr_scc_arfcn[i].split(",")[1];
                      }

                      // combine the PCC and SCC ARFCN values
                      this.earfcns = [nr_pcc_arfcn, ...nr_scc_arfcn]
                    } catch (error) {
                      this.earfcns = [nr_pcc_arfcn.replace(/,/g, "")]
                    }
                  } else if (
                    this.networkMode == "4G LTE FDD" ||
                    this.networkMode == "4G LTE TDD"
                  ) {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const lte_pcc_arfcn = lines
                      .find((line) => line.includes('+QCAINFO: "PCC"'))
                      .split(",")[1];

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const lte_scc_arfcn = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // if empty, then proceed to error block
                      if (lte_scc_arfcn.length == 0) {
                        throw "No SCC ARFCN";
                      }

                      // process all the values in the array and extract the ARFCN part only
                      for (let i = 0; i < lte_scc_arfcn.length; i++) {
                        lte_scc_arfcn[i] = lte_scc_arfcn[i].split(",")[1];
                      }

                      // combine the PCC and SCC ARFCN values
                      this.earfcns = [lte_pcc_arfcn, ...lte_scc_arfcn]
                    } catch (error) {
                      this.earfcns = [lte_pcc_arfcn.replace(/,/g, "")]
                    }
                  } else if (this.networkMode == "5G NSA") {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const lte_pcc_arfcn = lines
                      .find((line) => line.includes('+QCAINFO: "PCC"'))
                      .split(",")[1];

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const lte_scc_arfcn = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // If empty, then proceed to error block
                      if (lte_scc_arfcn.length == 0) {
                        throw "No SCC ARFCN";
                      }

                      // process all the values in the array and extract the ARFCN part only
                      for (let i = 0; i < lte_scc_arfcn.length; i++) {
                        lte_scc_arfcn[i] = lte_scc_arfcn[i].split(",")[1];
                      }

                      // combine the PCC and SCC ARFCN values
                      this.earfcns = [lte_pcc_arfcn, ...lte_scc_arfcn]
                    } catch (error) {
                      this.earfcns = [lte_pcc_arfcn.replace(/,/g, "")]
                    }
                  } else {
                    this.earfcns = [];
                  }

                  // --- PCI ---
                  if (
                    this.networkMode == "5G SA TDD" ||
                    this.networkMode == "5G SA FDD"
                  ) {
                    const nr_pcc_pci = lines
                      .find((line) => line.includes('+QCAINFO: "PCC"'))
                      .split(",")[4];

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const nr_scc_pci = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // if empty, then proceed to error block
                      if (nr_scc_pci.length == 0) {
                        throw "No SCC PCI";
                      }

                      // process all the values in the array and extract the PCI part only
                      for (let i = 0; i < nr_scc_pci.length; i++) {
                        nr_scc_pci[i] = nr_scc_pci[i].split(",")[5];
                      }

                      // combine the PCC and SCC PCI values
                      this.pcis = [nr_pcc_pci, ...nr_scc_pci];
                    } catch (error) {
                      // remove comma if only one value
                      this.pcis = [nr_pcc_pci];
                    }
                  } else if (
                    this.networkMode == "4G LTE FDD" ||
                    this.networkMode == "4G LTE TDD"
                  ) {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const lte_pcc_pci = lines
                      .find((line) => line.includes('+QCAINFO: "PCC"'))
                      .split(",")[5];

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const lte_scc_pci = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // if empty, then proceed to error block
                      if (lte_scc_pci.length == 0) {
                        throw "No SCC PCI";
                      }

                      // process all the values in the array and extract the PCI part only
                      for (let i = 0; i < lte_scc_pci.length; i++) {
                        lte_scc_pci[i] = lte_scc_pci[i].split(",")[5];
                      }

                      // combine the PCC and SCC PCI values
                      this.pcis = [lte_pcc_pci, ...lte_scc_pci];
                    } catch (error) {
                      this.pcis = [lte_pcc_pci];
                    }
                  } else if (this.networkMode == "5G NSA") {
                    // find this value from lines "+QCAINFO: \"PCC\"
                    const lte_pcc_pci = lines
                      .find((line) => line.includes('+QCAINFO: "PCC"'))
                      .split(",")[5];

                    try {
                      // Look for all the lines with this value "+QCAINFO: \"SCC\" and store them in an array
                      const lte_scc_pci = lines.filter((line) =>
                        line.includes('+QCAINFO: "SCC"')
                      );

                      // if empty, then proceed to error block
                      if (lte_scc_pci.length == 0) {
                        throw "No SCC PCI";
                      }

                      // process all the values in the array and extract the PCI part only
                      for (let i = 0; i < lte_scc_pci.length; i++) {
                        // if line contains LTE BAND then do this process
                        if (lte_scc_pci[i].includes("LTE BAND")) {
                          lte_scc_pci[i] = lte_scc_pci[i].split(",")[5];
                        } else {
                          lte_scc_pci[i] = lte_scc_pci[i].split(",")[4];
                        }
                      }

                      // combine the PCC and SCC PCI values
                      this.pcis = [lte_pcc_pci, ...lte_scc_pci];
                    } catch (error) {
                      this.pcis = [lte_pcc_pci];
                    }
                  } else {
                    this.pcis = [];
                  }

                  // --- IPv4 and IPv6 ---
                  // find the value from line "IPV4"
                  this.ipv4 = lines
                    .find((line) => line.includes("IPV4"))
                    .split(",")[4]
                    .replace(/"/g, "")
                    .replace(/\r/, "");

                  // find the value from line "IPV6"
                  this.ipv6 = lines
                    .find((line) => line.includes("IPV6"))
                    .split(",")[4]
                    .replace(/"/g, "")
                    .replace(/\r/, "");

                  // Traffic Stats
                  // +QGDNRCNT includes both NR and non-NR traffic counters
                  this.downloadStat = lines
                    .find((line) => line.includes("+QGDNRCNT:"))
                    .split(",")[1];

                  this.uploadStat = lines
                    .find((line) => line.includes("+QGDNRCNT:"))
                    .split(",")[0]
                    // remove the +QGDNRCNT: part
                    .replace("+QGDNRCNT: ", "");

                  // Convert the downloadStat and uploadStat bytes to readable size
                  this.downloadStat = this.bytesToSize(this.downloadStat);
                  this.uploadStat = this.bytesToSize(this.uploadStat);

                  // Signal Informations

                  const currentNetworkMode = this.networkMode;

                  if (
                    currentNetworkMode == "5G SA TDD" ||
                    currentNetworkMode == "5G SA FDD" ||
                    currentNetworkMode == "4G LTE FDD" ||
                    currentNetworkMode == "4G LTE TDD"
                  ) {
                    // find the value from line "+QENG: \"servingcell\""
                    // CellID
                    const longCID = lines
                      .find((line) => line.includes('+QENG: "servingcell"'))
                      .split(",")[6]
                      .replace(/"/g, "");

                    // Get the eNBID. Its just Cell ID minus the last 2 characters
                    this.eNBID = parseInt(longCID.substring(0, longCID.length - 2), 16);

                    // Get the short Cell ID (Last 2 characters of the Cell ID)
                    const shortCID = longCID.substring(longCID.length - 2);

                    if (
                      currentNetworkMode == "5G SA TDD" ||
                      currentNetworkMode == "5G SA FDD"
                    ) {
                      // TAC
                      this.tac = parseInt(
                        lines
                          .find((line) => line.includes('+QENG: "servingcell"'))
                          .split(",")[8]
                          .replace(/"/g, ""), 
                        16
                      )

                      // RSRP
                      this.rsrpNR = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[12]
                        .replace(/"/g, "");
                      this.rsrpLTE = '-';

                      // RSRQ
                      this.rsrqNR = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[13]
                        .replace(/"/g, "");
                      this.rsrqLTE = '-';

                      // RSSI
                      this.rssi = '-';

                      // SINR
                      this.sinrNR = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[14]
                        .replace(/"/g, "");
                      this.sinrLTE = '-';

                      // CQI NR
                      this.cqiNR = lines
                        .find((line) => line.includes('+QNWCFG: "nr5g_csi"'))
                        .split(",")[3]
                        .replace(/"/g, "");
                      this.cqiLTE = '-';

                      // RI NR
                      this.riNR = lines
                        .find((line) => line.includes('+QNWCFG: "nr5g_csi"'))
                        .split(",")[2]
                        .replace(/"/g, "");
                      this.riLTE = '-';

                      // MCS NR
                      this.mcsNR = lines
                        .find((line) => line.includes('+QNWCFG: "nr5g_csi"'))
                        .split(",")[1]
                        .replace(/"/g, "");
                      this.mcsLTE = '-';

                      // Calculate the RSRP Percentage
                      this.rsrpNRPercentage = this.calculateRSRPPercentage(
                        parseInt(this.rsrpNR)
                      );

                      // Calculate the RSRQ Percentage
                      this.rsrqNRPercentage = this.calculateRSRQPercentage(
                        parseInt(this.rsrqNR)
                      );

                      // Calculate the SINR Percentage
                      this.sinrNRPercentage = this.calculateSINRPercentage(
                        parseInt(this.sinrNR)
                      );

                      // Calculate the Signal Percentage
                      this.signalPercentage = this.calculateSignalPercentage(
                        this.rsrpNRPercentage,
                        this.sinrNRPercentage
                      );

                      // Calculate the Signal Assessment
                      this.signalAssessment = this.signalQuality(
                        this.signalPercentage
                      );
                    } else /* LTE Only */ {
                      // TAC
                      this.tac = parseInt(
                        lines
                          .find((line) => line.includes('+QENG: "servingcell"'))
                          .split(",")[12]
                          .replace(/"/g, ""), 
                        16
                      )

                      // RSRP
                      this.rsrpLTE = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[13]
                        .replace(/"/g, "");
                      this.rsrpNR = '-';

                      // RSRQ
                      this.rsrqLTE = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[14]
                        .replace(/"/g, "");
                      this.rsrqNR = '-';

                      // RSSI
                      this.rssi = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[15]
                        .replace(/"/g, "");

                      // SINR
                      this.sinrLTE = lines
                        .find((line) => line.includes('+QENG: "servingcell"'))
                        .split(",")[16]
                        .replace(/"/g, "");
                      this.sinrNR = '-';

                      // CQI LTE
                      this.cqiLTE = lines
                        .find((line) => line.includes('+QNWCFG: "lte_csi"'))
                        .split(",")[3]
                        .replace(/"/g, "");
                      this.cqiNR = '-';

                      // RI LTE
                      this.riLTE = lines
                        .find((line) => line.includes('+QNWCFG: "lte_csi"'))
                        .split(",")[2]
                        .replace(/"/g, "");
                      this.riNR = '-';

                      // MCS LTE
                      this.mcsLTE = lines
                        .find((line) => line.includes('+QNWCFG: "lte_csi"'))
                        .split(",")[1]
                        .replace(/"/g, "");
                      this.mcsNR = '-';

                      // Calculate the RSRP Percentage
                      this.rsrpLTEPercentage = this.calculateRSRPPercentage(
                        parseInt(this.rsrpLTE)
                      );

                      // Calculate the RSRQ Percentage
                      this.rsrqLTEPercentage = this.calculateRSRQPercentage(
                        parseInt(this.rsrqLTE)
                      );

                      // Calculate the SINR Percentage
                      this.sinrLTEPercentage = this.calculateSINRPercentage(
                        parseInt(this.sinrLTE)
                      );

                      // Calculate the Signal Percentage
                      this.signalPercentage = this.calculateSignalPercentage(
                        this.rsrpLTEPercentage,
                        this.sinrLTEPercentage
                      );

                      // Calculate the Signal Assessment
                      this.signalAssessment = this.signalQuality(
                        this.signalPercentage
                      );
                    }

                    this.cellID = parseInt(longCID, 16);
                    this.sectorID = parseInt(shortCID, 16);
                  } else if (currentNetworkMode == "5G NSA") {
                    // find the value from line "+QENG: \"LTE\" for LTE
                    const longCID = lines
                      .find((line) => line.includes('+QENG: "LTE"'))
                      .split(",")[4]
                      .replace(/"/g, "");

                    // Get the eNBID. Its just Cell ID minus the last 2 characters
                    this.eNBID = parseInt(longCID.substring(0, longCID.length - 2), 16);

                    // Cell ID
                    this.cellID = parseInt(longCID, 16);
                    this.sectorID = parseInt(longCID.substring(longCID.length - 2), 16);

                    // TAC
                    this.tac = parseInt(
                      lines
                        .find((line) => line.includes('+QENG: "LTE"'))
                        .split(",")[10]
                        .replace(/"/g, ""), 
                      16
                    )

                    // RSRP LTE
                    this.rsrpLTE = lines
                      .find((line) => line.includes('+QENG: "LTE"'))
                      .split(",")[11]
                      .replace(/"/g, "");

                    // RSRQ LTE
                    this.rsrqLTE = lines
                      .find((line) => line.includes('+QENG: "LTE"'))
                      .split(",")[12]
                      .replace(/"/g, "");

                    // RSSI LTE
                    this.rssi = lines
                      .find((line) => line.includes('+QENG: "LTE"'))
                      .split(",")[13]
                      .replace(/"/g, "");

                    // SINR LTE
                    this.sinrLTE = lines
                      .find((line) => line.includes('+QENG: "LTE"'))
                      .split(",")[14]
                      .replace(/"/g, "");

                    // CQI LTE
                    this.cqiLTE = lines
                      .find((line) => line.includes('+QNWCFG: "lte_csi"'))
                      .split(",")[3]
                      .replace(/"/g, "");

                    // RI LTE
                    this.riLTE = lines
                      .find((line) => line.includes('+QNWCFG: "lte_csi"'))
                      .split(",")[2]
                      .replace(/"/g, "");

                    // MCS LTE
                    this.mcsLTE = lines
                      .find((line) => line.includes('+QNWCFG: "lte_csi"'))
                      .split(",")[1]
                      .replace(/"/g, "");

                    // Calculate the RSRP LTE Percentage
                    this.rsrpLTEPercentage = this.calculateRSRPPercentage(
                      parseInt(this.rsrpLTE)
                    );

                    // Calculate the RSRQ LTE Percentage
                    this.rsrqLTEPercentage = this.calculateRSRQPercentage(
                      parseInt(this.rsrqLTE)
                    );

                    // Calculate the SINR LTE Percentage
                    this.sinrLTEPercentage = this.calculateSINRPercentage(
                      parseInt(this.sinrLTE)
                    );

                    // Calculate the Signal Percentage
                    const lte_signal_percentage =
                      

                    // find the value from line "+QENG: \"NR5G-NSA\" for NR5G
                    // RSRP NR
                    this.rsrpNR = lines
                      .find((line) => line.includes('+QENG: "NR5G-NSA"'))
                      .split(",")[4]
                      .replace(/"/g, "");

                    // RSRQ NR
                    this.rsrqNR = lines
                      .find((line) => line.includes('+QENG: "NR5G-NSA"'))
                      .split(",")[6]
                      .replace(/"/g, "");

                    // SINR NR
                    this.sinrNR = lines
                      .find((line) => line.includes('+QENG: "NR5G-NSA"'))
                      .split(",")[5]
                      .replace(/"/g, "");

                    // CQI NR
                    this.cqiNR = lines
                      .find((line) => line.includes('+QNWCFG: "nr5g_csi"'))
                      .split(",")[3]
                      .replace(/"/g, "");

                    // RI NR
                    this.riNR = lines
                      .find((line) => line.includes('+QNWCFG: "nr5g_csi"'))
                      .split(",")[2]
                      .replace(/"/g, "");

                    // MCS NR
                    this.mcsNR = lines
                      .find((line) => line.includes('+QNWCFG: "nr5g_csi"'))
                      .split(",")[1]
                      .replace(/"/g, "");

                    // Calculate the RSRP NR Percentage
                    this.rsrpNRPercentage = this.calculateRSRPPercentage(
                      parseInt(this.rsrpNR)
                    );

                    // Calculate the RSRQ NR Percentage
                    this.rsrqNRPercentage = this.calculateRSRQPercentage(
                      parseInt(this.rsrqNR)
                    );

                    // Calculate the SINR NR Percentage
                    this.sinrNRPercentage = this.calculateSINRPercentage(
                      parseInt(this.sinrNR)
                    );

                    // Average the LTE and NR Signal Percentages
                    this.signalPercentage = (
                      this.calculateSignalPercentage(this.rsrpLTEPercentage, this.sinrLTEPercentage) + 
                      this.calculateSignalPercentage(this.rsrpNRPercentage, this.sinrNRPercentage)
                    ) / 2;

                    // Calculate the Signal Assessment
                    this.signalAssessment = this.signalQuality(
                      this.signalPercentage
                    );
                  } else {
                    this.signalAssessment = "No Signal";
                  }
                }
              });
            });
          },

          bytesToSize(bytes) {
            const sizes = ["B", "KB", "MB", "GB", "TB"];
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i), 2) + " " + sizes[i];
          },

          requestPing() {
            return fetch("/cgi-bin/get_ping")
              .then((response) => response.text())
              .then((data) => {
                return data;
              })
              .catch((error) => {
                console.error("Error: ", error);
                // Throw the error again to ensure it's propagated
                throw error;
              });
          },

          calculateLteBandwidth(bw) {
            switch (true) {
              case bw == 6:
                return 1.4;
              case bw == 15:
                return 3;
              case bw == 25:
                return 5;
              case bw == 50:
                return 10;
              case bw == 75:
                return 15;
              default:
                return '---';
            }
          },

          calculateNrBandwidth(bw) {
            switch (true) {
              case bw >= 0 && bw <= 5:
                return (bw + 1) * 5;
              case bw >= 6 && bw <= 12:
                return (bw - 2) * 10;
              case bw === 13:
                return 200;
              case bw === 14:
                return 400;
              default:
                return '---';
            }
          },

          calculateLteDistance(ta) {
            const nta = Math.min(Math.max(ta, 0), 1282) * 16;
            const ts = 1 / (2048 * 15 * 1000);
            const c = 3 * 10 ** 8;

            return (c * (nta * ts)) / 2; // in meters
          },

          calculateNrDistance(nta) {
            const tc = 1 / (4096 * 480 * 1000);
            const c = 3 * 10 ** 8;

            return (c * Math.max(nta, 0) * tc) / 2; // in meters
          },

          calculateRSRPPercentage(rsrp) {
            let min = -135;
            let max = -65;

            // If rsrp is null, return 0%
            if (isNaN(rsrp) || rsrp < -140) {
              return 0;
            }

            let percentage = ((rsrp - min) / (max - min)) * 100;

            if (percentage > 100) {
              percentage = 100;
            }

            // if percentage is less than 25%, make it 25%
            if (percentage < 25) {
              percentage = 25;
            }

            return Math.round(percentage);
          },

          calculateRSRQPercentage(rsrq) {
            let min = -20;
            let max = -8;

            // If rsrq is null, return 0%
            if (isNaN(rsrq) || rsrq < -20) {
              return 0;
            }

            let percentage = ((rsrq - min) / (max - min)) * 100;

            if (percentage > 100) {
              percentage = 100;
            }

            // if percentage is less than 25%, make it 25%
            if (percentage < 25) {
              percentage = 25;
            }

            return Math.round(percentage);
          },

          calculateSINRPercentage(sinr) {
            let min = -10;
            let max = 35;

            // If sinr is null, return 0%
            if (isNaN(sinr) || sinr < -10) {
              return 0;
            }

            let percentage = ((sinr - min) / (max - min)) * 100;

            if (percentage > 100) {
              percentage = 100;
            }

            // if percentage is less than 25%, make it 25%
            if (percentage < 25) {
              percentage = 25;
            }

            return Math.round(percentage);
          },

          // Calculate the overall signal assessment
          calculateSignalPercentage(rsrpNRPercentage, sinrNRPercentage) {
            // Get the average of the RSRP Percentage and SINR Percentage
            let average = (rsrpNRPercentage + sinrNRPercentage) / 2;
            return Math.round(average);
          },

          signalQuality(percentage) {
            if (percentage >= 80) {
              return "Excellent";
            } else if (percentage >= 60) {
              return "Good";
            } else if (percentage >= 40) {
              return "Fair";
            } else if (percentage >= 0) {
              return "Poor";
            } else {
              return "No Signal";
            }
          },

          updateRefreshRate() {
            // Check if the refresh rate is less than 3
            if (this.newRefreshRate < 3) {
              this.newRefreshRate = 3;
            }

            // Clear the old interval
            clearInterval(this.intervalId);

            // Set the refresh rate
            this.refreshRate = this.newRefreshRate;

            // Store the refresh rate in local storage or session storage
            localStorage.setItem("refreshRate", this.refreshRate);

            // Initialize with the new refresh rate
            this.init();
          },

          init() {
            // Retrieve the refresh rate from local storage or session storage
            const storedRefreshRate = localStorage.getItem("refreshRate");

            // If a refresh rate is stored, use it; otherwise, use a default value
            this.refreshRate = storedRefreshRate ? parseInt(storedRefreshRate) : 3;

            this.fetchAllInfo();

            this.requestPing()
              .then((data) => {
                const response = data.trim();
                if (response === "OK") {
                  this.internetConnectionStatus = "Connected";
                } else {
                  this.internetConnectionStatus = "Disconnected";
                }
              })
              .catch((error) => {
                console.error("Error: ", error);
                this.internetConnectionStatus = "Disconnected";
              });

            this.lastUpdate = new Date().toLocaleString();
            console.log("Initialized");

            // Set the refresh rate for interval
            this.intervalId = setInterval(() => {
              this.fetchAllInfo();

              this.requestPing()
                .then((data) => {
                  const response = data.trim();
                  if (response === "OK") {
                    this.internetConnection = "Connected";
                  } else {
                    this.internetConnection = "Disconnected";
                  }
                })
                .catch((error) => {
                  console.error("Error: ", error);
                  this.internetConnection = "Disconnected";
                });

              this.lastUpdate = new Date().toLocaleString();
              console.log("Refreshed");
            }, this.refreshRate * 1000);
          },
        };
      }
    </script>
  </body>
</html>